# Logging in Dagger

Dagger documentation mentions several ways to get scheduler logs. In this directory you can find the relevant examples.

There are essentially two ways to save logs(log_sinks): straightforward LocalEventLog, which saves logs directly into the arrays contained in each worker, and the more modern MultiEventLog, which documentation recommends to use, and which comprises of consumers processing events (consumer may be responsible for some specific type of info) and aggregators.
Importantly, `LocalEventLog` stores raw events (`Dagger.TimespanLogging.Event`), whereas `MultiEventLog` processes them with consumers functions first, putting their results to the corresponding to this consumer array.

**IMPORTANT**

The examples and the herein text are relevant as of the Dagger 0.18.8 (unless otherwise stated)


## log_sink

This folder contains the examples of directly getting logs using log_sink and log_file parameters of the Dagger.Context. The focus here is to get the result in a `.dot` format to interpret it as a graph. This can be achieved via `Dagger.show_plan()` function. Essentially it gets the vector of timespans (of events), transforms them and writes result (`.dot` format) to a log_file. As mentioned earlier, `LocalEventLog` stores raw events; however, `get_logs!(::LocalEventLog; ...)` transforms them into the timespans, which are the inputs to a `Dagger.show_plan()`. All of that happens under the hood in `compute(...)` function (old Dagger API), which results in logs being written to a file. However, this is not the case for `MultiEventLog`, as it does not store raw events. Therefore, by default, only the combination old Dagger API and `LocalEventLog` can generate logs suitable to use for graph plotting.

### oldAPI_localeventlog.jl

Here, the LocalEventLog type of log_sink is used with the old API of Dagger (Dagger.delayed). This results in logs being written in the corresponding log file in the dot format (it is important to import Colors package, as it also enables the relevant Dagger function).

### oldAPI_multieventlog.jl

This file contains the combination of old Dagger API and `MultiEventLog` as the log_sink. However, only `LocalEventLog` log_sink can be used to write logs directly into a log_file using `collect(...)` (or `compute(...)`), due to how `Event`s are processed in `MultiEventLog`. In order to eventually write the logs to a file in a `.dot` format, we can use `Dagger.TimespanLogging.Events.FullMetrics` consumer which does nothing to the input event and return it as is, which is identical to `LocalEventLog` behaviour. Then, we can reproduce the workflow for the latter one.

### modernAPI_localeventlog.jl

Modern Dagger API and `LocalEventLog` `log_sink` are combined here. To get the results of the tasks execution, the `fetch(...)` function should be used (corresponds to the `collect(...)` in the old API). However, it does not write logs in any way to the `log_file`, so the logs are only stored in memory, but not flushed. 

As a workaround, we can use old API (`collect(...)`) to compute some mock function, so it will flush all the logs into the `log_file`, both the ones produced via using the modern API and those created while executing mock function.

More conscise would be to use dedicated Dagger functions. This is demonstrated in a second workaround in the file, and it looks similar to the one in the previous file.

However, all such workarounds in a modern API have a drawback - some arguments (Non-thunks) may not be displayed. From the documentation of Dagger 0.18.8:
 > `Dagger.show_plan` can also be called as `Dagger.show_plan(io::IO, logs)` to write the graph to a file or other `IO` object. The string generated by this function may be passed to an external tool like `Graphviz` for rendering. Note that this method doesn't display input arguments to the DAG (non-`Thunk`s); you can call `Dagger.show_plan(logs, thunk)`, where `thunk` is the output `Thunk` of the DAG, to render argument nodes.

As the modern API with `EagerThunk`s is used here, `Dagger.show_plan(logs, thunk)` can not be utilized.

In practice, running the examples showed that implementations with modern API indeed do not display all the arguments to the eager thunks, opposed to the old API, which do display them (see example .png graphs in the results folder). However, it should be possible to fix this with the inspection of `EagerThunk` and adding its arguments to the graph manually. 

### modernAPI_multieventlog.jl

Modern Dagger API used with `MultiEventLog`. By default, logs are not flushed to the `log_file` here as well, so the same kind of workaround is applied, as earlier (with the same drawback).

## Webdash

### 


## Enable logging

Current documentation suggests this way of logging as the easiest one, however, it is absent as of Dagger 0.18.8